
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>HOME - Stupid-Fast.com</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <script
    type="text/javascript"
    src="/js/lib/dummy.js"
    
  ></script>

    <link rel="stylesheet" type="text/css" href="/css/result-light.css">


  <style id="compiled-css" type="text/css">
    

a {
  margin: 15px;
}

.heading {
  color: darkgoldenrod;
  font-size: 1.2em;
}

table {
  border-collapse: collapse;
}

tr:nth-child(even) {
  background: whitesmoke;
}

th, td {
  padding: 3px;
}

    /* EOS */
  </style>

  <script id="insert"></script>

</head>
<body>
    <center>
  <center>
    <br>


    <a href="https://www.stupid-fast.com" class="banner">
      <img src="https://www.stupid-fast.com/banner.png">
    </a>
    <br>


    <center id="links" style="display: inline-block;">

    </center>
    <br>
    <br>



<center style="max-width: 290px;">
    <center style="max-width: 290px;">
      <table>

        <tbody id="tplayers"></tbody>

      </table>

    </center>



    <center>

      <h4>Current race:</h4>
      <table>
        <tbody id="traceinfo">

        </tbody>
      </table>

      <h4>Running order:</h4>
      <table>
        <tbody id="tcurrentrace"></tbody>
      </table>

      <h4>Live race feed: </h4>
      <table>
        <thead>
          <tr>
            <th>Lap</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="tracefeed"></tbody>
      </table>




      <h4>Stage results:</h4>
      <table>
        <thead>
          <tr id="shead">
            <th>Pos</th>
          </tr>

        </thead>
        <tbody id="tstages"></tbody>
        <tr id="sp0">
          <td>1</td>
        </tr>
        <tr id="sp1">
          <td>2</td>
        </tr>
        <tr id="sp2">
          <td>3</td>
        </tr>
        <tr id="sp3">
          <td>4</td>
        </tr>
        <tr id="sp4">
          <td>5</td>
        </tr>
        <tr id="sp5">
          <td>6</td>
        </tr>
        <tr id="sp6">
          <td>7</td>
        </tr>
        <tr id="sp7">
          <td>8</td>
        </tr>
        <tr id="sp8">
          <td>9</td>
        </tr>
        <tr id="sp9">
          <td>10</td>
        </tr>
      </table>

    </center>
    </center>
  </center>

</center>


    <script type="text/javascript">//<![CDATA[


var HOMEPAGE = []

function getHomepage() {
	fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/HOMEPAGE?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
  	return item.json()
  }).then(function(item) {
    var header = item.values.shift()
    HOMEPAGE = item.values.map(function(jtem) {
      return jtem.reduce(function(total, ktem, index) {
        total[header[index]] = ktem
        return total
      }, {})
    })
  	console.log("HOMEPAGE", HOMEPAGE)
    
    HOMEPAGE = HOMEPAGE.filter(function(jtem) {
    	return jtem.ACTIVE == "TRUE"
    })
    
    HOMEPAGE.forEach(function(jtem) {
    	var tag = document.createElement(jtem.TAG)
      tag.href = jtem.HREF
      tag.innerHTML = jtem.TEXT
      tag.target = jtem.TARGET
      tag.style = jtem.STYLE
      tag.id = jtem.id
      tag.className = jtem.CLASS
      console.log(tag)
      links.append(tag)

    })
  })
}

getHomepage()





var CURRENTRACE = ""
var PICKS = []
var PLAYERS = []
var PICKORDER = []
var DRIVERS = []
var INFO = []




function getPlayers() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PLAYERS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    PLAYERS = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })
    //console.log("PLAYERS", PLAYERS)

    PLAYERS = PLAYERS.filter(function(item) {
      return item.ACTIVE == "TRUE"
    })

    PLAYERS.forEach(function(item) {
      var tr = tplayers.insertRow()
      tr.id = item.PLAYERID
      //tr.insertCell().innerHTML = item.PLAYERID
    })

    getPickOrder()


  })
}

getPlayers()




function getPickOrder() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PICKORDER?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    PICKORDER = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })
    //console.log("PICKORDER", PICKORDER)

    PLAYERS.map(function(item, index) {
      var find = PICKORDER.find(function(jtem) {
        return jtem.PLAYERID == item.PLAYERID
      }) || {
        BLEND: null,
        ["SUM of TOTAL"]: null
      }
      item.BLEND = find.BLEND
      item.TOTAL = find["SUM of TOTAL"]
    })

    getCurrentRace()



  })

}


function getCurrentRace() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/INFO?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    INFO = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })[0]

    //console.log("INFO", INFO)

    getPicks()

  })

}


function getPicks() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PICKS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    PICKS = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })

    PICKS = PICKS.filter(function(item) {
      return item.RACEID == INFO.CURRENTRACE
    }).reverse()

    //console.log("PICKS", PICKS)

    getDrivers()

  })

}


function getDrivers() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/DRIVERS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    DRIVERS = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })

    DRIVERS.map(function(item) {
      var find = PICKS.find(function(jtem) {
        return jtem.DRIVERID == item.DRIVERID
      }) || {
        PLAYERID: null
      }

      item.PLAYERID = find.PLAYERID
    })

    //console.log("DRIVERS", DRIVERS)

    PLAYERS.map(function(item) {
      var filter = DRIVERS.filter(function(jtem) {
        return jtem.PLAYERID == item.PLAYERID
      }) || []

      item.PICKS = filter
    })

    buildTable()



  })

}




function buildTable() {
  PLAYERS = PLAYERS.sort(function(a, b) {
    return a.BLEND - b.BLEND
  })

  PLAYERS.forEach(function(item) {
    var tr = tplayers.insertRow()
    tr.insertCell().innerHTML = item.PLAYERNAME +
      " <small>(" + item.TOTAL + ")</small>"
    var td = tr.insertCell()
    var t = document.createElement("TABLE")
    item.PICKS.forEach(function(jtem) {
      t.insertRow().innerHTML = jtem.DRIVERNAME
    })
    td.append(t)
  })
}



//LIVEEEEEE



var CURRENTRACEID = []
var SCHEDULE = []
var CURRENTRACE = []
var LIVEPICKS = []
var LIVEPLAYERS = []
var FLAG = ""
var STAGES = []
var RACEFEED = []



function getLiveRace() {
  fetch("https://cf.nascar.com/cacher/live/live-feed.json").then(function(item) {
    return item.json()
  }).then(function(item) {
    CURRENTRACE = item
    //console.log("CURRENTRACE", CURRENTRACE)
    CURRENTRACEID = CURRENTRACE.race_id
    //console.log("CURRENTRACEID", CURRENTRACEID)

    traceinfo.innerHTML = "<tr><td>Track</td><td>" + CURRENTRACE.track_name + "</td></tr>"
    traceinfo.innerHTML += "<tr><td>Flag status</td><td>" + FLAG + "</td></tr>"
    traceinfo.innerHTML += "<tr><td>Stage</td><td>" + CURRENTRACE.stage.stage_num + "</td></tr>"
    traceinfo.innerHTML += "<tr><td>Lap</td><td>Lap " +
      CURRENTRACE.lap_number + " / " +
      CURRENTRACE.laps_in_race + " (" +
      CURRENTRACE.laps_to_go + " laps to go)</td></tr>"


    //vehicles live running order table
    //tcurrentrace.innerHTML = ""
    CURRENTRACE.vehicles.forEach(function(jtem) {
      var tr = tcurrentrace.insertRow()
      tr.id = "c" + jtem.vehicle_number
      tr.insertCell().innerHTML = jtem.running_position
      tr.insertCell().innerHTML = jtem.driver.full_name.split("(")[0] + " <small>" + Math.round(-jtem.delta * 10) / 10 + "</small>"
      //tr.insertCell().innerHTML =
    })

    getStages()

  })
}

getLiveRace()


function getStages() {
  fetch("https://cf.nascar.com/cacher/live/live-stage-points.json").then(function(item) {
    return item.json()
  }).then(function(item) {
    STAGES = item
    //console.log("STAGES", STAGES)

    STAGES.forEach(function(jtem) {
      var th = document.createElement("TH")
      th.innerHTML = "Stage " + jtem.stage_number
      shead.append(th)

      jtem.results.forEach(function(ktem, k) {

        if (ktem.stage_points) {
          var tr = document.getElementById("sp" + k)
          tr.insertCell().innerHTML = ktem.full_name
        }
      })
    })

    getRaceFeed()
    getLivePicks()
  })
}




function getFlagData() {
  fetch("https://cf.nascar.com/live/feeds/live-flag-data.json").then(function(item) {
    return item.json()
  }).then(function(item) {
    var flagstatus = item[item.length - 1]
    //console.log("FLAG HISTOPRY", item)


    switch (flagstatus.flag_state) {
      case 8:
        FLAG = "🏴 black"
        break;

      case 1:
        FLAG = "🟢 green"
        break;

      case 2:
        FLAG = "🟡 caution"
        break;

      case 4:
        FLAG = "🏁 checkered"
        break;

      case 9:
        FLAG = "🏁 checkered"
        break;
    }
    //console.log("FLAG", FLAG)

  })
}
getFlagData()



function getRaceFeed() {
  fetch("https://cf.nascar.com/cacher/2023/1/" + CURRENTRACEID + "/lap-notes.json").then(function(item) {
    return item.json()
  }).then(function(item) {
    RACEFEED = item.laps
    //console.log("RACEFEED", RACEFEED)

    for (var i in RACEFEED) {
      RACEFEED[i].forEach(function(jtem) {
        var tr = document.createElement("TR")
        tr.insertCell().innerHTML = i
        tr.insertCell().innerHTML = jtem.Note
        tracefeed.prepend(tr)
      })

    }
  })
}


function getLivePicks() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PICKS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(item) {
    var header = item.values.shift()
    LIVEPICKS = item.values.map(function(jtem) {
      return jtem.reduce(function(total, ktem, index) {
        total[header[index]] = ktem
        return total
      }, {})
    })
    LIVEPICKS = LIVEPICKS.filter(function(jtem) {
      return jtem.RACEID == CURRENTRACEID
    }).reverse()

    //console.log("PICKS", PICKS)

    CURRENTRACE.vehicles.map(function(jtem) {
      var find = LIVEPICKS.find(function(ktem) {
        return jtem.vehicle_number == ktem.DRIVERID.split("c")[1]
      }) || {
        PLAYERID: null
      }
      jtem.PLAYERID = find.PLAYERID

      var tr = document.getElementById("c" + jtem.vehicle_number)
      var td = tr.insertCell()
      td.classList.add(jtem.PLAYERID)
      td.innerHTML = jtem.PLAYERID
    })

    getLivePlayers()

  })
}



function getLivePlayers() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PLAYERS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(item) {
    var header = item.values.shift()
    LIVEPLAYERS = item.values.map(function(jtem) {
      return jtem.reduce(function(total, ktem, index) {
        total[header[index]] = ktem
        return total
      }, {})
    })
    LIVEPLAYERS = LIVEPLAYERS.filter(function(jtem) {
      return jtem.ACTIVE == "TRUE"
    })

    //console.log("PLAYERS", PLAYERS)

    CURRENTRACE.vehicles.map(function(jtem) {
      var find = LIVEPLAYERS.find(function(ktem) {
        return jtem.PLAYERID == ktem.PLAYERID
      }) || {
        PLAYERNAME: ""
      }
      jtem.PLAYERNAME = find.PLAYERNAME

      var td = document.getElementsByClassName(jtem.PLAYERID)
      for (var i of td) {
        i.innerHTML = "<i>" + jtem.PLAYERNAME + "</i>"
      }
    })
    
    mapPts()

  })

}


function mapPts() {
	var arr = CURRENTRACE.vehicles.slice()
  arr.reverse()
  
  var count = 1
  arr.map(function(item) {
  	if (item.PLAYERID) {
    	item.PTS = count++
    } else {
    	item.PTS = null
    }
    
    var tr = document.getElementById("c" + item.vehicle_number)
    tr.insertCell().innerHTML = item.PTS
  })
  
}







  //]]></script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "mebwpqh1"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>


</body>
</html>
