
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>PICKS TABLE SUMMARY</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <script
    type="text/javascript"
    src="/js/lib/dummy.js"
    
  ></script>

    <link rel="stylesheet" type="text/css" href="/css/result-light.css">


  <style id="compiled-css" type="text/css">
    body,
html {
  //font-family: Tahoma, sans-serif;
  //font-size: 0.95em;
}

table {
  border-collapse: collapse;
  border: 0px solid;
}

td,
th {
  border: 0px solid;
  border-spacing: 10px 10px;
  padding: 0px 3px 0px 3px;
}

#tplayers>tr:nth-child(even) {
  background: whitesmoke;
}

h3 {
  margin-top: 40px;
}



th {
  text-align: left;
}


h4 {
  margin-top: 40px;
}


    /* EOS */
  </style>

  <script id="insert"></script>

</head>
<body>
    <table>

  <tbody id="tplayers"></tbody>

</table>


    <script type="text/javascript">//<![CDATA[


var CURRENTRACE = ""
var PICKS = []
var PLAYERS = []
var PICKORDER = []
var DRIVERS = []
var INFO = []




function getPlayers() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PLAYERS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    PLAYERS = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })
    console.log("PLAYERS", PLAYERS)

    PLAYERS = PLAYERS.filter(function(item) {
      return item.ACTIVE == "TRUE"
    })

    PLAYERS.forEach(function(item) {
      var tr = tplayers.insertRow()
      tr.id = item.PLAYERID
      //tr.insertCell().innerHTML = item.PLAYERID
    })

    getPickOrder()


  })
}

getPlayers()




function getPickOrder() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PICKORDER?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    PICKORDER = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })
    console.log("PICKORDER", PICKORDER)

    PLAYERS.map(function(item, index) {
      var find = PICKORDER.find(function(jtem) {
        return jtem.PLAYERID == item.PLAYERID
      }) || {
        BLEND: null,
        ["SUM of TOTAL"]: null
      }
      item.BLEND = find.BLEND
      item.TOTAL = find["SUM of TOTAL"]
    })

    getCurrentRace()



  })

}


function getCurrentRace() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/INFO?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    INFO = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })[0]

    console.log("INFO", INFO)

    getPicks()

  })

}


function getPicks() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/PICKS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    PICKS = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })

    PICKS = PICKS.filter(function(item) {
      return item.RACEID == INFO.CURRENTRACE
    }).reverse()

    console.log("PICKS", PICKS)

    getDrivers()

  })

}


function getDrivers() {
  fetch("https://sheets.googleapis.com/v4/spreadsheets/1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU/values/DRIVERS?alt=json&key=AIzaSyDhLaELifRHh1xemqXD92dXajIdevmltSQ").then(function(item) {
    return item.json()
  }).then(function(result) {
    var header = result.values.shift()
    DRIVERS = result.values.map(function(item) {
      return item.reduce(function(total, jtem, j) {
        total[header[j]] = jtem
        return total
      }, {})
    })

    DRIVERS.map(function(item) {
      var find = PICKS.find(function(jtem) {
        return jtem.DRIVERID == item.DRIVERID
      }) || {
        PLAYERID: null
      }

      item.PLAYERID = find.PLAYERID
    })

    console.log("DRIVERS", DRIVERS)

    PLAYERS.map(function(item) {
      var filter = DRIVERS.filter(function(jtem) {
        return jtem.PLAYERID == item.PLAYERID
      }) || []

      item.PICKS = filter
    })

    buildTable()



  })

}




function buildTable() {
  PLAYERS = PLAYERS.sort(function(a, b) {
    return a.BLEND - b.BLEND
  })

  PLAYERS.forEach(function(item) {
    var tr = tplayers.insertRow()
    tr.insertCell().innerHTML = item.PLAYERNAME +
      " <small>(" + item.TOTAL + ")</small>"
    var td = tr.insertCell()
    var t = document.createElement("TABLE")
    item.PICKS.forEach(function(jtem) {
      t.insertRow().innerHTML = jtem.DRIVERNAME
    })
    td.append(t)
  })
}



  //]]></script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "tq0enxbw"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>


</body>
</html>
